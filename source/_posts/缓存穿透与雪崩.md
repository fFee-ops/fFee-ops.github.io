---
title: 缓存穿透与雪崩
date: 2020-09-07 15:15:57
tags: 
categories: Redis
---

<!--more-->

### 缓存穿透与雪崩

- [缓存穿透](#_2)
- - [简介](#_3)
  - [解决办法](#_6)
- [缓存雪崩](#_13)
- - [简介](#_14)
  - [解决办法](#_17)

# 缓存穿透

## 简介

缓存穿透是指查询一个一定不存在的数据，由于缓存不命中时需要从数据库查询，查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到数据库去查询，造成缓存穿透。

## 解决办法

持久层查询不到就缓存空结果，以后再查询时先判断缓存中是否exists\(key\) ,如果有直接返回空，没有则查询后返回空结果。

注意：如果之后给这个数据插入了值，那么需清除之前key的空结果，否则即便DB中有值也查询不到\(当然也可以设置空缓存的过期时间）

# 缓存雪崩

## 简介

缓存大量失效的时候，引发大量查询数据库。

## 解决办法

①用锁/分布式锁或者队列串行访问 缓存失效时间均匀分布

如果缓存集中在一段时间内失效，发生大量的缓存穿透，所有的查询都落在数据库上，造成了缓存雪崩。  
这个没有完美解决办法，但可以分析用户行为，尽量让失效时间点均匀分布。大多数系统设计者考虑用加锁或者队列的方式保证缓存的单线程（进程）写，从而避免失效时大量的并发请求落到底层存储系统上。

②数据预热  
可以通过缓存reload机制，预先去更新缓存，再即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀