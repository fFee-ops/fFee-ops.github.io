---
title: 乐观锁、悲观锁
date: 2021-02-09 22:29:06
tags: 
categories: JUC
---

<!--more-->

### 乐观锁、悲观锁

- [基本概念](#_2)
- [实现方式](#_8)
- [优缺点和适用场景](#_15)

# 基本概念

乐观锁和悲观锁是两种思想，用于解决并发场景下的数据竞争问题。

- 乐观锁：乐观锁在操作数据时非常乐观，认为别人不会同时修改数据。因此乐观锁不会上锁，只是在执行更新的时候判断一下在此期间别人是否修改了数据：如果别人修改了数据则放弃操作，否则执行操作。
- 悲观锁：悲观锁在操作数据时比较悲观，认为别人会同时修改数据。因此操作数据时直接把数据锁住，直到操作完成后才会释放锁；上锁期间其他人不能修改数据。

# 实现方式

**乐观锁和悲观锁是两种思想，它们的使用是非常广泛的，不局限于某种编程语言或数据库。**

- 悲观锁的实现方式是加锁，加锁既可以是对代码块加锁（如Java的synchronized关键字），也可以是对数据加锁（如MySQL中的排它锁）。
- 乐观锁的实现方式主要有**两种**：CAS机制和版本号机制。

# 优缺点和适用场景

乐观锁和悲观锁并没有优劣之分，它们有各自适合的场景；

**根据竞争激烈程度来看：**  
如果悲观锁和乐观锁都可以使用，那么选择就要考虑竞争的激烈程度：

- 当竞争不激烈 \(出现并发冲突的概率小\)时，乐观锁更有优势，因为悲观锁会锁住代码块或数据，其他线程无法同时访问，影响并发，而且加锁和释放锁都需要消耗额外的资源。
- 当竞争激烈\(出现并发冲突的概率大\)时，悲观锁更有优势，因为乐观锁在执行更新时频繁失败，需要不断重试，浪费CPU资源。

悲观锁多用于写，乐观锁多用于读。