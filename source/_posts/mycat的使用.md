---
title: mycat的使用
date: 2021-10-05 15:15:12
tags: mysql 数据库
categories: MyCat
---

<!--more-->

### mycat的使用

- [读写分离](#_2)
- [数据切分](#_7)
- - [1、垂直切分](#1_14)
  - [2、水平切分](#2_42)
  - [3、总结](#3_84)

# 读写分离

通过mycat和mysql的主从复制配合搭建数据库的读写分离，可以实现mysql的高可用性，下面我们来搭建mysql的读写分离。

详细见[这里](https://sliing.blog.csdn.net/article/details/117962124)

# 数据切分

数据的切分根据其切分规则的类型，可以分为两种切分模式。一种是按照不同的表来切分到不同的数据库之上，这种切可以称之为数据的垂直切分或者纵向切分，另外一种则是根据表中的数据的逻辑关系，将同一个表中的数据按照某种条件拆分到多台数据库上面，这种切分称之为数据的水平切分或者横向切分。

垂直切分的最大特点就是 规则简单，实施也更为方便，尤其适合各业务之间的耦合度非常低，相互影响很小，业务逻辑非常清晰的系统。在这种系统中，可以很容易做到将不同业务模块所使用的表分拆到不同的数据库中。根据不同的表来进行拆分，对应用程序的影响也很小，拆分规则也会比较简单清晰。

水平切分与垂直切分相比，相对来说稍微复杂一些。因为要将同一个表中的不同数据拆分到不同的数据库中，对于应用程序来说，拆分规则本身就较根据表明来拆分更为复杂，后期的数据维护也会更为复杂一些。

## 1、垂直切分

​ 一个数据库由很多表的构成，每个表对应着不同的业务，垂直切分是指按照业务将表进行分类，分布到不同的数据库上面，这样也就将数据或者压力分担到不同的库上面。

![在这里插入图片描述](https://img-blog.csdnimg.cn/e2cff220ecda45459ed52e7e57d5f5b1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZkZlZS1vcHM=,size_20,color_FFFFFF,t_70,g_se,x_16)

​ 如上图所示，一个系统被切分成了用户系统、订单交易、支付系统等多个库。

一般来讲业务存在着复杂join的场景是难以切分的，往往业务独立的易于切分。如何切分，切分到何种程度是考验技术架构的一个难题。下面来分析下垂直切分的优缺点：

​ 优点：

​ 1、拆分后业务清晰，拆分规则明确

​ 2、系统之间整合或扩展容易

​ 3、数据维护简单

​ 缺点：

​ 1、部分业务表无法实现join，只能通过接口方式解决，提高了系统复杂度

​ 2、受每种业务不同的限制存在单库性能瓶颈，不易数据扩展跟性能提高

​ 3、事务处理复杂

## 2、水平切分

​ 相对于垂直拆分，水平拆分不是将表做分类，而是按照某个字段的某种规则来分散到多个库中，每个表中包含一部分数据。简单来说，我们可以将数据的水平切分理解为是按照数据行切分，就是将表中的某些行切分到一个数据库，而另外的某些行又切分到其他的数据库中，  
![在这里插入图片描述](https://img-blog.csdnimg.cn/38c3553e13ba40d1ba9976f86d7bc834.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZkZlZS1vcHM=,size_19,color_FFFFFF,t_70,g_se,x_16)

​ 拆分数据就需要定义分片规则。关系型数据库是行列的二维模型，拆分的第一原则是找到拆分维度。比如从会员的角度来分析，商户订单交易类系统中查询会员某天某月某个订单，那么就需要按照会员结合日期来拆分，不同的数据按照会员id做分组，这样所有的数据查询join都会在单库内解决；如果从商户的角度来讲，要查询某个商家某天所有的订单数，就需要按照商户id做拆分；但是如果系统既想按照会员拆分，又想按照商家数据拆分，就会有一定的困难，需要综合考虑找到合适的分片。

​ 几种典型的分片规则包括：

​ 1、按照用户id取模，将数据分散到不同的数据库，具有相同数据用户的数据都被分散到一个库中；

​ 2、按照日期，将不同月甚至日的数据分散到不同的库中；

​ 3、按照某个特定的字段求模，或者根据特定范围段分散到不同的库中。

​ 如图，切分原则都是根据业务找到适合的切分规则分散到不同的库，下图是用用户id求模的案例：  
![在这里插入图片描述](https://img-blog.csdnimg.cn/49bb69851fa8408ab99ea6917f85d0a0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZkZlZS1vcHM=,size_20,color_FFFFFF,t_70,g_se,x_16)

​ 数据做完了水平拆分之后也是有优缺点的。

​ 优点：

​ 1、拆分规则抽象好，join操作基本可以数据库做；

​ 2、不存在单库大数据，高并发的性能瓶颈；

​ 3、应用端改造较少；

​ 4、提高了系统的稳定性跟负载能力

​ 缺点：

​ 1、拆分规则难以抽象

​ 2、分片事务一致性难以解决

​ 3、数据多次扩展跟维护量极大

​ 4、跨库join性能较差

## 3、总结

mycat在做数据切分的时候应该尽可能的遵循以下原则，当然这也是经验之谈，最终的落地实现还是要看具体的应用场景在做具体的分析

​ 第一原则：能不切分尽量不要切分

​ 第二原则：如果要切分一定要选择合适的切分规则，提前规划好

​ 第三原则：数据切分尽量通过数据冗余或表分组来降低跨库join的可能

​ 第四原则：由于数据库中间件对数据join实现的优劣难以把握，而且实现高性能难度极大，业务读取尽量少使用多表join。