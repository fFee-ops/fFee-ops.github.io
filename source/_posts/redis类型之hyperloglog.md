---
title: hyperloglog
date: 2020-08-11 11:33:17
tags: 
categories: Redis
---

<!--more-->

### 文章目录

- [简介](#_2)
- [为什么需要HyperLoglog](#HyperLoglog_18)
- [常用命令](#_22)
- [应用场景](#_31)
- [总结](#_42)

# 简介

Redis 在 2.8.9 版本添加了 HyperLogLog 结构。  
Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。

---

在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2\^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。  
但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。

---

**什么是基数\?**  
比如数据集 \{1, 3, 5, 7, 5, 7, 8\}， 那么这个数据集的基数集为 \{1, 3, 5 ,7, 8\}, 基数\(不重复元素\)为5。  
基数估计就是在误差可接受的范围内，快速计算基数。

# 为什么需要HyperLoglog

如果要统计1亿个数据的基数值，大约需要内存100000000/8/1024/1024 ≈ 12M，内存减少占用的效果显著。  
然而统计一个对象的基数值需要12M，如果统计10000个对象，就需要将近120G，同样不能广泛用于大数据场景。

# 常用命令

```sql
PFADD key element [element ...] :添加指定元素到 HyperLogLog 中

PFCOUNT key [key ...] :返回给定 HyperLogLog 的基数估算值

PFMERGE destkey sourcekey [sourcekey ...] :将多个 HyperLogLog 合并为一个 HyperLogLog
```

# 应用场景

**基数不大，数据量不大就用不上，会有点大材小用浪费空间 有局限性，就是只能统计基数数量，而没办法去知道具体的内容是什么**

例如:  
统计注册 IP 数  
统计每日访问 IP 数  
统计页面实时 UV 数  
统计在线用户数  
统计用户每天搜索不同词条的个数  
统计真实文章阅读数

# 总结

- HyperLogLog**是一种算法**，并非redis独有  
  目的是做基数统计，故不是集合，不会保存元数据，只记录数量而不是数值。
- 耗空间极小，支持输入非常体积的数据量
- 核心是基数估算算法，主要表现为计算时内存的使用和数据合并的处理。最终数值存在一定误差
- 误差说明：基数估计的结果是一个带有 0.81\% 标准错误（standard error）的近似值。是可接受的范围